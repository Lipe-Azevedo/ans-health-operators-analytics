<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ANS Analytics</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
</head>
<body>
    <div id="app" class="container py-4">
        <header class="mb-4 text-center">
            <h1 class="text-primary fw-bold">Painel de Operadoras ANS</h1>
            <p class="text-muted">Consulta de Despesas e Indicadores Financeiros</p>
        </header>

        <ul class="nav nav-pills nav-fill mb-4 bg-white p-2 rounded shadow-sm">
            <li class="nav-item">
                <a class="nav-link" :class="{active: currentView === 'lista'}" href="#" @click.prevent="currentView = 'lista'">ðŸ“‹ Lista</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" :class="{active: currentView === 'dashboard'}" href="#" @click.prevent="loadDashboard">ðŸ“Š Dashboard</a>
            </li>
        </ul>

        <div v-if="loading" class="loading">
            <div class="spinner-border text-primary" role="status"></div>
            <div class="mt-2">Carregando dados...</div>
        </div>

        <div v-if="currentView === 'lista' && !loading">
            <div class="row mb-4">
                <div class="col-md-8 offset-md-2">
                    <div class="input-group">
                        <input type="text" v-model="searchQuery" @keyup.enter="fetchOperadoras(1)" class="form-control" placeholder="Buscar por RazÃ£o Social ou CNPJ...">
                        <button class="btn btn-primary" @click="fetchOperadoras(1)">Buscar</button>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Registro</th>
                                <th>CNPJ</th>
                                <th>RazÃ£o Social</th>
                                <th>UF</th>
                                <th class="text-end">AÃ§Ãµes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="op in operadoras" :key="op.registro_ans" class="clickable" @click="verDetalhes(op.cnpj)">
                                <td>{{ op.registro_ans }}</td>
                                <td>{{ op.cnpj }}</td>
                                <td>{{ op.razao_social }}</td>
                                <td>{{ op.uf }}</td>
                                <td class="text-end"><button class="btn btn-sm btn-outline-primary">Detalhes</button></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="mt-3 text-center" v-if="totalPages > 1">
                <button class="btn btn-sm btn-secondary me-2" :disabled="page <= 1" @click="fetchOperadoras(page - 1)">Anterior</button>
                <span>{{ page }} / {{ totalPages }}</span>
                <button class="btn btn-sm btn-secondary ms-2" :disabled="page >= totalPages" @click="fetchOperadoras(page + 1)">PrÃ³xima</button>
            </div>
        </div>

        <div v-show="currentView === 'dashboard'" class="row g-4">
            <div class="col-md-6">
                <div class="card p-3 border-success border-start border-4 text-center">
                    <h5 class="text-muted small">Total Despesas</h5>
                    <div class="stat-value text-success">{{ formatMoney(stats.total_despesas) }}</div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card p-3 border-info border-start border-4 text-center">
                    <h5 class="text-muted small">MÃ©dia Geral</h5>
                    <div class="stat-value text-info">{{ formatMoney(stats.media_despesas) }}</div>
                </div>
            </div>
            <div class="col-12">
                <div class="card p-3">
                    <h5>Top 5 Maiores Despesas</h5>
                    <canvas id="chartTop5" height="80"></canvas>
                </div>
            </div>
        </div>

        <div v-if="selectedOperadora" class="modal fade show d-block" style="background: rgba(0,0,0,0.5)">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">{{ selectedOperadora.razao_social }}</h5>
                        <button class="btn-close" @click="selectedOperadora = null"></button>
                    </div>
                    <div class="modal-body">
                        <p><strong>CNPJ:</strong> {{ selectedOperadora.cnpj }} | <strong>UF:</strong> {{ selectedOperadora.uf }}</p>
                        <table class="table table-sm table-striped" v-if="despesasHistorico.length">
                            <thead><tr><th>Data</th><th>DescriÃ§Ã£o</th><th>Valor</th></tr></thead>
                            <tbody>
                                <tr v-for="d in despesasHistorico">
                                    <td>{{ d.trimestre }}</td>
                                    <td>{{ d.descricao }}</td>
                                    <td>{{ formatMoney(d.valor_despesas) }}</td>
                                </tr>
                            </tbody>
                        </table>
                        <div v-else class="alert alert-warning">Sem registros de despesas.</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="js/app.js"></script>
</body>
</html>